<!DOCTYPE html>
<html>
    <head>
        <title>Sentral 2 - Explore</title>
        
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta content="width=device-width, initial-scale=1.0" name="viewport" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

        <!--     Fonts and icons     -->
        <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:400,700|Material+Icons" />
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css">
        <!-- Material Kit CSS -->
        <link href="assets/css/material-dashboard.css?v=2.1.2" rel="stylesheet" />
        
        <!-- <link rel="icon" href="static/tabicon"> -->
        <link rel="stylesheet" href="static/mainstyle.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

        <script>
            class tag
            {
                static tags = [];
                static htmlBegin = String.raw
                `
                <button class="btn btn-warning btn-sm" onclick="
                `;
                static htmlCenter = String.raw
                `
                ">
                `;
                static htmlEnd = String.raw
                `
                &nbsp<i class="material-icons">close</i></button>
                `;
            }
            class questionSort
            {
                static type = 'new';
            }

            function addTag(tagStr)
            {
                if (!tag.tags.includes(tagStr))
                {
                    tag.tags.push(tagStr);
                    updateTags();
                }
            }
            function removeTag(tagStr)
            {
                tag.tags = tag.tags.filter(item => item !== tagStr);
                updateTags();
            }
            function updateTags()
            {
                let e = document.getElementById('tags-html');
                e.innerHTML = '';
                tag.tags.forEach(item => {
                    e.innerHTML += tag.htmlBegin + `removeTag(\'${item}\')` + tag.htmlCenter + item + tag.htmlEnd; 
                });
            }
            function searchForQuestions()
            {
                var xmlHttp = new XMLHttpRequest();
                let tagConcat = tag.tags.join(';');
                console.log(tagConcat === "");
                if (tagConcat === "")
                {
                    //xmlHttp.open("GET", "http://8c22ba59c936.ngrok.io/api/v1/questions/?type=org");
                }
                else
                {
                    //xmlHttp.open("GET", `http://8c22ba59c936.ngrok.io/api/v1/questions/?type=org&tag=${tagConcat}`);
                }
                /*xmlHttp.setRequestHeader("Access-Control-Allow-Origin", "*");
                xmlHttp.send();
                console.log(xmlHttp.responseText);*/

                let testReturn = `[{"author":null,"date_time":"2021-04-03T10:00:00Z","id":1,"question_screenshot_id":null,"question_text":"Describe a scenario where Dijkstra's algorithm would be most suited for.","rating":10,"tags_list":"AL;12;Shortest-path algorithms","view_count":0},{"author":null,"date_time":"2021-04-03T10:00:00Z","id":2,"question_screenshot_id":null,"question_text":"How do roller coasters keep their passengers in their seat when they are upside-down on the loop?","rating":3,"tags_list":"PH;12;Circular motion","view_count":0},{"author":null,"date_time":"2021-04-04T10:00:00Z","id":8,"question_screenshot_id":"Test question 3","question_text":"Test question 3","rating":0,"tags_list":null,"view_count":0},{"author":"David Kong","date_time":"2021-04-04T10:00:00Z","id":9,"question_screenshot_id":null,"question_text":"How do I access the API in JS?","rating":0,"tags_list":null,"view_count":0}]`;

                let parsedData = JSON.parse(testReturn);
                console.log(parsedData);

                if (questionSort.type === 'new')
                {
                    parsedData.sort((a, b) => {
                        if (Date.parse(a) === Date.parse(b))
                            return 0;
                        else if (Date.parse(a) > Date.parse(b))
                            return 1;
                        else return -1;
                    });
                }
                var cards = '';
                parsedData.forEach(element => {
                    var tags = ''
                    if (element.tags_list !== null)
                    {
                        element.tags_list.split(';').forEach(item => {
                            tags += `<a href="#"><button class="btn btn-info btn-sm">${item}</button></a>`
                        });
                    }

                    cards += String.raw
                    `
                    <div class="question-card"><div class="card">
                        <div class="card-header">
                            <h3 class="card-title"><a href="#">${element.question_text}</a></h3>
                            <p class="category">
                                <p></p>
                                Subject:
                                <a href="#"><button class="btn btn-warning btn-sm">TODO: Implement this.</button></a>
                                <br>Tags:
                                ${tags}
                            </p>
                        </div>
                        <div class="card-body">
                            Asked By: ${element.author} | At: ${element.date_time.replace('T', ' ').replace('Z', '')} | Rating: ${element.rating}
                        </div>
                    </div></div>
                    `;
                });
                document.getElementById('question-cards').innerHTML = cards;
            }
        </script>
    </head>


    <body>
        <div class="sidebar">
            <div class="logo"><img src="static/logo.png"></div>
            <p></p>
            <p><a href="index.html"><button class="btn btn-default btn-lg btn-link fit"><i class="material-icons">home</i> Home</button></a></p>
            <p><a href="explore.html"><button class="btn btn-default btn-lg btn-link fit"><i class="material-icons">search</i> Explore</button></a></p>
            <p><a href="help.html"><button class="btn btn-default btn-lg btn-link fit"><i class="material-icons">help</i> Help</button></a></p>
            <p><a href="About us .html"><button class="btn btn-default btn-lg btn-link fit"><i class="material-icons">group</i> About us</button></a></p>

        </div>

        <div class="content">

            <h1>Sentral 2 - Explore</h1>
            <br>

            <form class="search-box" onsubmit="searchForQuestions()">
                <input id="search-input" type="text" placeholder="Search..." name="search">
            </form>

            <form onsubmit="let t = document.getElementById('tag-input').value; if (t !== '') addTag(t); return false;">
                <button class="btn btn-primary">
                    <i class="material-icons">add</i> 
                    &nbspAdd Tag&nbsp&nbsp
                </button>
                <input style="padding: 4px;", id="tag-input", type="text" placeholder="Tag..." name="tag">
                <button class="btn btn-success right-align" onclick="searchForQuestions()">
                    <i class="material-icons">search</i>
                </button>
            </form>

            <div id="tags-html">
            </div>

            <button class="btn btn-secondary" onclick="searchForQuestions()">New</button>
            <button class="btn btn-secondary">Trending</button>
            <button class="btn btn-secondary">Most Popular</button>
            
            <div class="cards"><div class="row" id="question-cards">
                
            </div></div>

        </div>

    </body>
</html>
